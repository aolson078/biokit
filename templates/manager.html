{% extends "base.html" %}

{% block title %}
Manager
{% endblock %}

{% block content %}
<div class="employee-search">
    <h3>Select User</h3>
    <select id="employee-dropdown">
        <option value="">-- Select an Employee --</option>
        {% for user in users %}
        <option value="{{ user.id }}">{{ user.username }}</option>
        {% endfor %}
    </select>
    <button onclick="getUserReports()">Select User</button>
</div>

<div id="report-container"></div>

<script>
    function getUserReports() {
        const userId = document.getElementById('employee-dropdown').value;
        if (!userId) {
            alert('Please select a user');
            return;
        }

        fetch(`/get_user_reports/${userId}`)
            .then(response => response.json())
            .then(data => {
                const reportContainer = document.getElementById('report-container');
                reportContainer.innerHTML = ''; // Clear previous content

                if (data.reports.length > 0) {
                    data.reports.forEach(report => {
                        const reportDiv = document.createElement('div');
                        reportDiv.innerHTML = `
                            <p>Report ID: ${report.id}</p>
                            <p>Nucleotide IDs: ${report.nucleotide_ids}</p>
                            <p>Organisms: ${report.organisms}</p>
                            <!-- Add other fields when needed -->
                            <button onclick="displayReport(${report.id})">Display</button>
                            <button onclick="deleteReport(${report.id})">Delete</button>
                            <button onclick="downloadReport(${report.id})">Download</button>
                            <hr>
                        `;
                        reportContainer.appendChild(reportDiv);
                    });
                } else {
                    reportContainer.innerHTML = '<p>No reports found for this user.</p>';
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    function displayReport(reportId) {
        window.location.href = '/display_report/' + reportId;
        console.log("Display Report: " + reportId);
    }

    function deleteReport(reportId) {
            if (confirm('Are you sure you want to delete this report?')) {
                fetch(`/delete_report/${reportId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    // Optionally, refresh the report list after deletion
                    getUserReports();
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
    }

    function downloadReport(reportId) {
        window.location.href = '/download_report/' + reportId;
    }

</script>
{% endblock %}